<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GT Role Store</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #0d1117;
      color: #e6edf3;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      background: #161b22;
      padding: 20px;
      font-size: 24px;
      font-weight: 700;
      color: #58a6ff;
    }
    main {
      max-width: 600px;
      margin: 40px auto;
      background: #161b22;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 20px #00000050;
    }
    input {
      width: 80%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 8px;
      border: none;
      background: #0d1117;
      color: white;
      text-align: center;
    }
    button {
      background: #238636;
      color: white;
      border: none;
      padding: 10px 20px;
      margin-top: 10px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover {
      background: #2ea043;
    }
    .role-list {
      margin-top: 20px;
      text-align: left;
    }
    .role {
      background: #0d1117;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      border: 1px solid #30363d;
    }
    .role h3 {
      margin: 0;
      color: #58a6ff;
    }
    .dana-box {
      background: #21262d;
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      font-size: 14px;
      line-height: 1.6;
    }
    a {
      color: #58a6ff;
      text-decoration: none;
    }
    .small {
      font-size: 12px;
      color: #aaa;
    }
  </style>
</head>
<body>
  <header>ðŸ’Ž Growfax Shop</header>
  <main>
    <p>Masukkan <b>GrowID</b> dan <b>GrowFax</b> kamu di bawah untuk membeli role.</p>

    <input type="text" id="growid" placeholder="Masukkan GrowID kamu" />
    <input type="text" id="growfax" placeholder="Masukkan GrowFax kamu" />
    <br />
    <button onclick="checkSaldo()">ðŸ’° Cek Saldo</button>
    <p id="saldoDisplay" class="small"></p>

    <div class="role-list" id="roleList"></div>

    <div class="dana-box">
      <b>Pembayaran via DANA</b><br>
      Nomor DANA kamu: <span style="color:#58a6ff; font-weight:bold;">0895338912670</span><br>
      Bayar lewat DANA sesuai nominal role.<br>
      <small>(Trakteer otomatis membaca transaksi untuk update saldo)</small><br>
      <a href="teer.id/vivj" target="_blank">
        ðŸ”— Buka Trakteer Top Up
      </a>
    </div>
  </main>

  <script>
    const roles = [
      { key: "vip", name: "VIP", price: 8000 },
      { key: "vip_plus", name: "VIP+", price: 20000 },
      { key: "moderator", name: "Moderator", price: 36000 },
      { key: "supermod", name: "Super Moderator", price: 60000 },
      { key: "developer", name: "Developer", price: 88000 },
      { key: "god", name: "God", price: 104000 },
      { key: "god_max", name: "God [MAX]", price: 160000 }
    ];

    const roleList = document.getElementById("roleList");

    roles.forEach(r => {
      const div = document.createElement("div");
      div.className = "role";
      div.innerHTML = `
        <h3>${r.name}</h3>
        <p>Harga: ${r.price.toLocaleString()} saldo</p>
        <button onclick="beliRole('${r.key}')">Beli ${r.name}</button>
      `;
      roleList.appendChild(div);
    });

    async function checkSaldo() {
      const growid = document.getElementById("growid").value.trim();
      const growfax = document.getElementById("growfax").value.trim();
      if (!growid || !growfax)
        return alert("Isi GrowID dan GrowFax dulu!");

      document.getElementById("saldoDisplay").innerText = "Memeriksa saldo...";
      try {
        const res = await fetch("/api/check-balance", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ growid, growfax })
        });
        const data = await res.json();
        if (data.ok)
          document.getElementById("saldoDisplay").innerText =
            "Saldo kamu: " + data.balance.toLocaleString() + " saldo";
        else
          document.getElementById("saldoDisplay").innerText = "Tidak ada saldo ditemukan.";
      } catch (err) {
        document.getElementById("saldoDisplay").innerText = "Gagal mengambil data saldo.";
      }
    }

    async function beliRole(roleKey) {
      const growid = document.getElementById("growid").value.trim();
      const growfax = document.getElementById("growfax").value.trim();
      if (!growid || !growfax)
        return alert("Isi GrowID dan GrowFax dulu!");

      if (!confirm("Yakin ingin membeli role ini?")) return;

      const res = await fetch("/api/buy", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ growid, growfax, role_key: roleKey })
      });
      const data = await res.json();
      if (data.ok) {
        alert("Pembelian berhasil! Sisa saldo: " + data.balance);
        checkSaldo();
      } else {
        alert("Gagal beli: " + (data.msg || "unknown"));
      }
    }
  </script>
</body>
</html>

